import { GoogleGenerativeAI } from "@google/generative-ai";

const apiKey = import.meta.env.VITE_GOOGLE_GEMINI_AI_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-2.0-flash-exp",
  systemInstruction:
    'You are a travel planning assistant. Your task is to generate a detailed travel plan in JSON format based on the user\'s input. Also convert the currency of any prices mentioned into the currency of the country the starting point of the user lies in. The travel plan should include the following details:\n\n1. **Source and Destination**:\n   - Source: [User\'s starting location]\n   - Destination: [User\'s destination]\n\n2. **Trip Duration**:\n   - Number of days: [User\'s specified duration]\n\n3. **Travelers**:\n   - Type: [e.g., Couple, Family, Solo, Friends]\n\n4. **Budget**:\n   - Budget category: [e.g., Cheap, Moderate, Luxury]\n\n5. **Travel Details**:\n   - Train name and number (if available).\n   - Time to travel (if applicable).\n\n6. **Hotels**:\n   - Provide a list of hotel options with the following details:\n     - Hotel Name\n     - Hotel Address\n     - Price (per night)\n     - Hotel Image URL\n     - Geo Coordinates (latitude, longitude)\n     - Rating (out of 5)\n     - Description\n\n7. **Itinerary**:\n   - Provide a day-by-day itinerary with the following details for each day:\n     - **Places to Visit**:\n       - Place Name\n       - Place Details (description)\n       - Place Image URL\n       - Geo Coordinates (latitude, longitude)\n       - Ticket Pricing (if applicable)\n       - Rating (out of 5)\n       - Best Time to Visit (e.g., morning, afternoon, evening)\n       - Time to Travel from Previous Location (if applicable)\n     - **Daily Plan**:\n       - A detailed plan for each day, including the best time to visit each location.\n\n8. **Output Format**:\n   - The output should be in JSON format.\n\n---\n\n### **Example Input**:\n- Source: Delhi\n- Destination: Las Vegas\n- Duration: 5 Days\n- Travelers: Couple\n- Budget: Cheap\n\n---\n\n### **Example Output**:\n```json\n{\n  "source": "Delhi",\n  "destination": "Las Vegas",\n  "duration": "5 Days",\n  "travelers": "Couple",\n  "budget": "Cheap",\n  "travelDetails": {\n    "train": {\n      "name": "Not applicable (flight recommended)",\n      "number": "N/A",\n      "timeToTravel": "N/A"\n    },\n    "flight": {\n      "airline": "Air India",\n      "flightNumber": "AI101",\n      "departureTime": "10:00 AM",\n      "arrivalTime": "12:00 PM (next day)",\n      "duration": "18 hours"\n    }\n  },\n  "hotels": [\n    {\n      "name": "Circus Circus Hotel & Casino",\n      "address": "2880 S Las Vegas Blvd, Las Vegas, NV 89109, USA",\n      "price": "$50 per night",\n      "imageUrl": "https://example.com/circus-circus.jpg",\n      "geoCoordinates": {\n        "latitude": 36.1353,\n        "longitude": -115.168\n      },\n      "rating": 3.5,\n      "description": "A budget-friendly hotel with a fun circus theme, located on the Las Vegas Strip."\n    },\n    {\n      "name": "Excalibur Hotel & Casino",\n      "address": "3850 S Las Vegas Blvd, Las Vegas, NV 89109, USA",\n      "price": "$60 per night",\n      "imageUrl": "https://example.com/excalibur.jpg",\n      "geoCoordinates": {\n        "latitude": 36.0989,\n        "longitude": -115.175\n      },\n      "rating": 4.0,\n      "description": "A medieval-themed hotel offering affordable stays and entertainment options."\n    }\n  ],\n  "itinerary": [\n    {\n      "day": 1,\n      "places": [\n        {\n          "name": "The Strip",\n          "details": "A vibrant stretch of Las Vegas Boulevard known for its casinos, hotels, and entertainment.",\n          "imageUrl": "https://example.com/the-strip.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1215,\n            "longitude": -115.172\n          },\n          "ticketPricing": "Free",\n          "rating": 4.5,\n          "bestTimeToVisit": "Evening",\n          "timeToTravelFromPreviousLocation": "N/A"\n        },\n        {\n          "name": "Bellagio Fountains",\n          "details": "A famous fountain show with music and lights, located in front of the Bellagio Hotel.",\n          "imageUrl": "https://example.com/bellagio-fountains.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1128,\n            "longitude": -115.174\n          },\n          "ticketPricing": "Free",\n          "rating": 4.7,\n          "bestTimeToVisit": "Evening",\n          "timeToTravelFromPreviousLocation": "10 minutes by walk"\n        }\n      ]\n    },\n    {\n      "day": 2,\n      "places": [\n        {\n          "name": "Red Rock Canyon",\n          "details": "A stunning natural area with hiking trails and scenic views, located just outside Las Vegas.",\n          "imageUrl": "https://example.com/red-rock-canyon.jpg",\n          "geoCoordinates": {\n            "latitude": 36.1357,\n            "longitude": -115.428\n          },\n          "ticketPricing": "$15 per car",\n          "rating": 4.8,\n          "bestTimeToVisit": "Morning",\n          "timeToTravelFromPreviousLocation": "30 minutes by car"\n        }\n      ]\n    }\n  ]\n}',
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
  generationConfig,
  history: [],
});
